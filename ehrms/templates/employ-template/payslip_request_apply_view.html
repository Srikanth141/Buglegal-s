{% extends 'employ-template/base_template.html' %}
{%load mathfilters%} {%load humanize%}
{% block main_content %}
<!-- {% block page_title %}
Leave Report and Apply for Leave
{% endblock page_title %} -->
<title>Request for Payslip</title>
<!-- <style>
  .label {
      font-size: medium;
  }

  input {
      background-color: #393f5c;
  }

  h4 {
      color: white;
  }

  tr:nth-child(even) {
      background-color: #242b4d
  }

  tr:nth-child(odd) {
      background-color: #2d3354
  }
</style>


<style>
  /* Styles for all screen sizes */
  .table-bordered {
      border-collapse: collapse;
      width: 100%;
  }

  .table-row,
  .table-cell {
      display: table-cell;
      border: 1px solid #ccc;
      padding: 10px;
  }

  .table--hide {
      display: none;
  }

  /* Responsive layout for smaller screens */
  @media (max-width: 768px) {
      .table td {
          height: auto;
          padding: 10px;
      }

      .table-container {
          overflow-x: auto;
      }

      .table-row,
      .table-cell {
          display: block;
          border: none;
          padding: 6px 10px;
          width: 100%;
          box-sizing: border-box;
          text-align: left;
      }

      .table-hide {
          display: none;
      }

      .col-12 {
          padding: 0%;
      }

      .table--row {
          width: 100%;
          margin: 0;
      }
  }

  /* Additional styles */
  label {
      color: white;
      font-size: 25px;
  }

  /* .vamsi:hover {
      border: 5px solid rgb(79, 30, 119);
  } */

  .vamsi {
      /* background-color: rgb(145, 114, 253); */
      color: aliceblue;
      float: right;
      margin-right: 130px;
  }

  @media (max-width: 500px) {
      .vamsi {
          /* background-color: rgb(145, 114, 253); */
          color: aliceblue;
          float: left;
          margin-left: 10px; /* Adjust margin for smaller screens */
      }
  }

  .ff {
      width: 100%;
  }
  

  @media (max-width: 768px) {
      .vamsi {
          width: ; /* Adjust width for smaller screens */
          margin: 0 auto; /* Center the button */
          
      }
      .na{
        width: ; /* Adjust width for smaller screens */
          margin: 0 auto; /* Center the button */
          
      }
  }
</style> -->

<style>

    
.form-hr{

box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
border: 20px; 
padding: 30px;
background-color: #d1d7e0;
border-radius: 10px;
color: black;

}
.col-hr button{
border-radius: 10px;
padding:10px;
background-color: #9878b7;
box-shadow: 3px 0 0 3px #9878b7;
border: none;
color:white;

}
.col-hr{
margin-top: 30px;
}
.col-hr button:hover{
background-color: #b69ccf;
box-shadow: 3px 0 0 3px #b69ccf;
color:white;

}
.hed-hr{
color:black;
font-size: 36px;
}
  .col-manager button{
    border-radius: 10px;
    padding:10px;
    background-color: #ffb833;
    box-shadow: 3px 0 0 3px #cc8500;
    border: none;
    color:#005f66;

   }
   .col-manager{
    margin-top: 30px;
   }
   .col-manager button:hover{
    background-color: #a8cde6;
    box-shadow: 3px 0 0 3px #000;
    color:black;

   }
   .hed-manager{
    color:blue;
    font-size: 36px;
   }
   form{
    width: 95%;
   }
   .form-manager{
    box-shadow: 2px 3px 10px #999;
    margin-left: 20px;
    padding: 30px;
    border-radius:10px;
   }
   label{
    color:#666
   }
   .hed-tm{
    color:#ff7733;
    font-size: 36px;
   }

   .form-tm{
    box-shadow: 2px 3px 10px #999;
    margin-left: 20px;
    padding: 30px;
    border-radius:10px;
   }
   .col-tm button{
    border-radius: 10px;
    padding:10px;
    background-color: #cccccc;
    box-shadow: 3px 0 0 3px #bfbfbf;
    border: none;
    color :#000
;

   }
   .col-tm{
    margin-top: 30px;
   }
   .col-tm button:hover{
    background-color:   #4d67ab;
    box-shadow: 3px 0 0 3px #3f558d;
    color: #fff;
}
.hed-tl{
  color:black;
}
{% if mem_role == 'Employee' and mem_team_lead_ext == 1 %}
 button{
  background-color: rgb(234, 137, 137); 
  color: white;
  padding: 10px;
  border-radius: 10px;
 }
 {% endif %}
</style>


<div id="message">
  {% if messages %}
  {% for message in messages %}
  {% if message.tags == 'error' %}
  <div class="alert alert-danger" style="margin-top:20px;">{{message}}</div>
  {% endif %}
  {% if message.tags == 'success' %}
  <div class="alert alert-success" style="margin-top:20px; background-color: green; color:whitesmoke;">{{message}}</div>
  {% endif %}
  {% endfor %}
  {% endif %}
</div>
<script>
  $("#message").show();
  setTimeout(function(){
      $("#message").hide();
  },2000)
  

  
</script>
<div class="container">
  <div class="row">
    <div class="col-md-8">
      <center>

        <h3 class="{% if mem_role == 'HR' and mem_hroptions == 1 %}hed-hr{% elif mem_role == 'Project Manager' and mem_projectmanagerop == 1 %}hed-manager{% elif mem_role == 'Employee' and mem_team_lead_ext == 1 %}hed-tl{% elif mem_role == 'Employee' and mem_team_lead_ext == 0 %}hed-tm {% endif %}">Request For Payslips</h3>

      </center>
      <br>
      <form id="myForm" action="{% url 'payslip_apply_view_save' %}" method="post" style="float: left;" enctype="multipart/form-data" class="{% if mem_role == 'HR' and mem_hroptions == 1 %}form-hr{% elif mem_role == 'Project Manager' and mem_projectmanagerop == 1 %}form-manager{% elif mem_role == 'Employee' and mem_team_lead_ext == 1 %}form-tl{% elif mem_role == 'Employee' and mem_team_lead_ext == 0 %}form-tm {% endif %}">
        {% csrf_token %}
          <!-- <div class="form-group">
              <label>Date *</label>
              <input type="month"  name="monthyear" max="9999-12" class="form-control" required>
          </div> -->


          <div class="form-group">
            <label>From  * </label>
            <input type="month" id="fromdate" class="form-control"  name="startingdate" required>
            <span id="error-msg-fromdate" style="color: red; display: none;">Please select the From Date.</span>

          </div>
        
          <div class="form-group">
            <label> To  *</label>
            <input type="month" class="form-control" id="frommo"  name="endingdate" required>
            <span id="error-msg-todate" style="color: red; display: none;">Please select the To Date.</span> 	
        </div>
          <div class="form-group">
              <label>Request Reason *</label>
              <textarea style="background-color: #fff;color: #000;" class="form-control" rows="6"
                  name="reason" required></textarea>
              <span id="error-msg-reason" style="color: red; display: none;">Please provide a reason.</span>
          </div>
          <script>
            document.querySelector('form').addEventListener('submit', function(event) {
                var fromDate = document.getElementById('fromdate').value;
                var toDate = document.getElementById('todate').value;
                var reason = document.getElementById('reason').value;
                var errorFromDate = document.getElementById('error-msg-fromdate');
                var errorToDate = document.getElementById('error-msg-todate');
                var errorReason = document.getElementById('error-msg-reason');
                var isValid = true;
        
                if (!fromDate) {
                    errorFromDate.style.display = 'block';
                    isValid = false;
                } else {
                    errorFromDate.style.display = 'none';
                }
        
                if (!toDate) {
                    errorToDate.style.display = 'block';
                    isValid = false;
                } else {
                    errorToDate.style.display = 'none';
                }
        
                if (!reason) {
                    errorReason.style.display = 'block';
                    isValid = false;
                } else {
                    errorReason.style.display = 'none';
                }
        
                if (!isValid) {
                    event.preventDefault();
                }
            });
        
            document.getElementById('fromdate').addEventListener('input', function() {
                document.getElementById('error-msg-fromdate').style.display = 'none';
            });
        
            document.getElementById('todate').addEventListener('input', function() {
                document.getElementById('error-msg-todate').style.display = 'none';
            });
        
            document.getElementById('reason').addEventListener('input', function() {
                document.getElementById('error-msg-reason').style.display = 'none';
            });
        </script>
        <div class="card-footer">
          <input type="submit" class="btn btn-primary btn-block" id="fetch_student" value="Request Payslip">
        </div>
      </form>
    </div>
 
    <script>
      window.onload = function () {
          var today = new Date();
          var currentMonth = today.getMonth() + 1;
          var currentYear = today.getFullYear();
  
          var inputMonth = document.getElementById('fromdate'); 
          var inputtomonth = document.getElementById('frommo');
          var message=document.getElementById('error-msg-format')
         if (inputMonth.value){
             document.getElementById('error-msg-format').style.display = 'none'
         }
         else{
          document.getElementById('error-msg-format').style.display = 'block'
         }
          inputMonth.addEventListener('change', function() {
              // When the fromdate input changes, update the min attribute of frommo input
              inputtomonth.min = this.value;
              if (!this.value) {
                    message.style.display = 'block';
                } else {
                    message.style.display = 'none';
                }
          });
  
          // Set initial min and max attributes
          inputtomonth.min = inputMonth.value;
          inputtomonth.max = "{{ currentmonth }}";
          inputMonth.min = "{{ startingdate }}";  
          inputMonth.max = "{{ currentmonth }}";  
      };
  </script>
  

  <div class="col-md-4 col-lg-4 col-sm-4 {% if mem_role == 'HR' and mem_hroptions == 1 %}col-hr{% elif mem_role == 'Project Manager' and mem_projectmanagerop == 1 %}col-manager{% elif mem_role == 'Employee' and mem_team_lead_ext == 1 %}col-tl{% elif mem_role == 'Employee' and mem_team_lead_ext == 0 %}col-tm {% endif %}" >
    <a href="{% url 'paysliprequest' %}">
        <button style="background-color: reg(234, 137, 137); color:white; padding: 10px; border-radius: 10px;" >
          <h5><b>View Past Payslip Requests</b></h5>
          <h6>Review the progress of all your previous Payslip requests... </h6>
        </button>
      </a><br><br>
      {% if palnid == "1" %}
      {% if adm.show1 == 1 %}
      
        <a href="/advancesalary_request/">
          <button style="background-color: reg(234, 137, 137); color:white; padding: 10px; border-radius: 10px;">
          <!-- <i class="fa fa-paper-plane pb-2" style="padding-left: 20px;"></i> -->
          <h5><b>Salary Advance</b></h5>
          <h6> Request a Salary Advance by viewing or requesting it...</h6>
     </button>
        </a>
     
      {% elif mon %}
      <a href="/advancesalary_request/">
        <button style="background-color: reg(234, 137, 137); color:white; padding: 10px; border-radius: 10px;">
        <!-- <i class="fa fa-paper-plane pb-2" style="padding-left: 20px;"></i> -->
        <h5><b>Salary Advance</b></h5>
        <h6> Request a Salary Advance by viewing or requesting it...</h6>
   </button>
      </a>
      {% endif %}
      
      {% elif  palnid == "2" %}
      {% if adm.show2 == 1 %}
      <a href="/advancesalary_request/">
        <button style="background-color: reg(234, 137, 137); color:white; padding: 10px; border-radius: 10px;">
        <!-- <i class="fa fa-paper-plane pb-2" style="padding-left: 20px;"></i> -->
        <h5><b>Salary Advance</b></h5>
        <h6> Request a Salary Advance by viewing or requesting it...</h6>
   </button>
      </a>
      {% elif mon %}
      <a href="/advancesalary_request/">
        <button style="background-color: reg(234, 137, 137); color:white; padding: 10px; border-radius: 10px;">
        <!-- <i class="fa fa-paper-plane pb-2" style="padding-left: 20px;"></i> -->
        <h5><b>Salary Advance</b></h5>
        <h6> Request a Salary Advance by viewing or requesting it...</h6>
   </button>
      </a>
      {% endif %}
      {% elif  palnid == "3" %}
      {% if adm.show3 == 1 %}
      <a href="/advancesalary_request/">
        <button style="background-color: reg(234, 137, 137); color:white; padding: 10px; border-radius: 10px;">
        <!-- <i class="fa fa-paper-plane pb-2" style="padding-left: 20px;"></i> -->
        <h5><b>Salary Advance</b></h5>
        <h6> Request a Salary Advance by viewing or requesting it...</h6>
   </button>
      </a>
      {% elif mon %}
      <a href="/advancesalary_request/">
        <button style="background-color: reg(234, 137, 137); color:white; padding: 10px; border-radius: 10px;">
        <!-- <i class="fa fa-paper-plane pb-2" style="padding-left: 20px;"></i> -->
        <h5><b>Salary Advance</b></h5>
        <h6> Request a Salary Advance by viewing or requesting it...</h6>
   </button>
      </a>
      {% endif %}

      {% else %}
      <a href="/advancesalary_request/">
        <button style="background-color: reg(234, 137, 137); color:white; padding: 10px; border-radius: 10px;">
        <!-- <i class="fa fa-paper-plane pb-2" style="padding-left: 20px;"></i> -->
        <h5><b>Salary Advance</b></h5>
        <h6> Request a Salary Advance by viewing or requesting it...</h6>
   </button>
      </a>

      {% endif %}
    </div>
  </div>
</div>

<!-- <script>
  // Get the current date
  var currentDate = new Date();
  var currentYear = currentDate.getFullYear();
  var currentMonth = currentDate.getMonth() + 1; 

  // Set the current year and month as default values and restrict future months
  var monthYearInput = document.querySelector('input[type="month"]');
  monthYearInput.setAttribute('max', currentYear + '-' + ('0' + currentMonth).slice(-2)); // Set max attribute to current year-month
  monthYearInput.setAttribute('value', currentYear + '-' + ('0' + currentMonth).slice(-2)); // Set default value to current year-month

  // Disable future months
  monthYearInput.addEventListener('input', function () {
      var selectedYear = parseInt(this.value.split('-')[0]);
      var selectedMonth = parseInt(this.value.split('-')[1]);

      if (selectedYear > currentYear || (selectedYear === currentYear && selectedMonth > currentMonth)) {
          this.value = currentYear + '-' + ('0' + currentMonth).slice(-2);
      }
  });
</script> -->

<!-- <script>
  $(document).ready(function() {
    var elem = $("#duration");
    if (elem) {
        elem.keydown(function() {
            if (elem.val().length > 10)
                elem.val(elem.val().substr(0, 10));
        });
    }            
});
</script> -->
<script>
  // Select the input field and error message span
  const durationInput = document.getElementById('duration');
  const errorMsgFormat = document.getElementById('error-msg-format');

  // Function to hide error message
  function hideErrorMessage() {
      errorMsgFormat.style.display = 'none';
  }

  // Add an event listener for input
  durationInput.addEventListener('input', function(event) {
      // Get the entered value
      const inputValue = event.target.value.trim();

      // Check if the value matches the format 'number month(s)' ignoring case
      const regex = /^(60|[1-5]\d|[1-9])\s+(month)s?$/i;

      if (inputValue === '' || !regex.test(inputValue)) {
          // Display error message for incorrect format
          errorMsgFormat.style.display = 'block';
      } else {
          // Hide error message
          hideErrorMessage();
      }
  });

  // Hide error message when the page loads
  window.onload = hideErrorMessage;
</script>


<script>
$(document).ready(function () {
    var dateOfJoining = "{{ joining_date }}";
    var joiningDate = new Date(dateOfJoining);
    var today = new Date();

    // Set the minimum month and year
    var minMonth = joiningDate.getMonth() + 1;
    var minYear = joiningDate.getFullYear();
    var minDate = minYear + '-' + ('0' + minMonth).slice(-2);

    // Set the min attribute of the input field
    $('#monthyear').attr('min', minDate);

    // Disable months before the joining date and after the current month
    $('#monthyear').on('change', function () {
        var selectedDate = new Date($(this).val() + '-31'); // Set day to 01
        var currentMonth = new Date(today.getFullYear(), today.getMonth(), 1); // First day of the current month
        if (selectedDate < joiningDate || selectedDate > currentMonth) {
            $(this).val(minDate);
        }
    });

    // Set the max attribute of the input field to the last day of the current month
    var lastDayOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
    var maxDate = lastDayOfMonth.getFullYear() + '-' + ('0' + (lastDayOfMonth.getMonth() + 1)).slice(-2);
    $('#monthyear').attr('max', maxDate);
});
</script>

{% endblock main_content %}
